<!DOCTYPE html>
<html>
<head>
    <title>Simon Says Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* Les classes quarter-circleX sont utilis√©es pour le menu (animation de pulsation). */
        .quarter-circle1, .q1 {
            width: 170px;
            height: 170px;
            background-color: red;
            color: red; 
            border-top-left-radius: 150px;
            position: absolute;
            top: 150px;
            left: 600px;
            box-shadow: 0 0 20px 5px red;
            animation: pulse 2s infinite;
            animation-delay: 0s;
        }

        .quarter-circle2, .q2 {
            width: 170px;
            height: 170px;
            background-color: green;
            color: green;
            border-top-right-radius: 150px;
            position: absolute;
            top: 150px;
            left: 750px;
            box-shadow: 0 0 20px 5px green;
            animation: pulse 2s infinite;
            animation-delay: 0.5s;
        }
        
        .quarter-circle3, .qc3 {
            width: 170px;
            height: 170px;
            background-color: blue;
            color: blue;
            border-bottom-left-radius: 150px;
            position: absolute;
            top: 300px;
            left: 600px;
            box-shadow: 0 0 20px 5px blue;
            animation: pulse 2s infinite;
            animation-delay: 1s;
        }
        
        .quarter-circle4, .qc4 {
            width: 170px;
            height: 170px;
            background-color: yellow;
            color: yellow;
            border-bottom-right-radius: 150px;
            position: absolute;
            top: 300px;
            left: 750px;
            box-shadow: 0 0 20px 5px yellow;
            animation: pulse 2s infinite;
            animation-delay: 1.5s;
        }

        /* Animation de pulsation (pour le MENU) */
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px 5px currentColor; /* Utilise la couleur de fond/texte */
                opacity: 1;
            }
            50% {
                box-shadow: 0 0 40px 20px currentColor;
                opacity: 0.8;
            }
        }
        
        /* Classe ajout√©e par JavaScript pour le 'flash' durant le jeu */
        .active {
            opacity: 1;
            /* Ombre tr√®s intense pour le flash */
            box-shadow: 0 0 60px 25px currentColor !important; 
            opacity: 0.8;
            /* D√©sactive l'animation de pulsation CSS par d√©faut durant le jeu */
            animation: none !important; 
            transition: box-shadow 0.05s; /* Rend le flash plus instantan√© */
        }
        
        /* Appliquer le curseur cliquable uniquement dans la section jeu */
        #jeu div[data-color] {
            cursor: pointer;
        }
       
        
        .simon1 {
            color: aliceblue;
            width: 150px;
            height: 150px;
            background-color: black;
            border-radius: 50%;
            position: absolute;
            top: 230px;
            left: 680px;
            font-family: 'Press Start 2P', monospace;
            font-size: 20px; 
            color: #FFFFFF;
            border: none;
            outline: none;
            cursor: pointer;
            
            display: flex; /* Permet le centrage du texte ::before */
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .simon1::before {
            content: 'SIMON SAYS'; 
            color: aliceblue;
            white-space: pre-wrap; /* Permet un retour √† la ligne si vous ajoutez \n */
        }
        .simon1:hover {
            background-color: #FFFFFF;
        }
        .simon1:hover::before {
            content: 'START PLAYING'; 
            color: black;
        }
        

        .simon2, .simon3 {
            font-family: 'Press Start 2P', monospace;
            font-size: 20px;
            color: #FFFFFF;
            width: 250px;
            height: 80px;
            background-color: black;
            border-radius: 30px;
            position: absolute;
            left: 630px;
            padding: 10px 15px;
            border: 2px solid white; /* Ajout d'une bordure pour un meilleur look r√©tro */
            outline: none;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .simon2 { top: 520px; }
        .simon3 { top: 610px; }
        .simon2:hover, .simon3:hover {
            background-color: #333; 
        }

        /* Le bouton central du jeu (#btn-game-center) qui affiche le statut/score */
        .btn {
            color: aliceblue;
            width: 150px;
            height: 150px;
            background-color: black;
            border-radius: 50%;
            position: absolute;
            top: 230px;
            left: 680px;
            font-family: 'Press Start 2P', monospace;
            font-size: 20px;
            color: #FFFFFF;
            border: none;
            outline: none;
            cursor: default; /* Pas cliquable pour d√©marrer, g√©r√© par JS */
            
            /* Styles Flexbox pour centrer le texte du statut */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        /* Style pour s'assurer que le contenu g√©n√©r√© par JS est centr√© */
        #btn-game-center, #Center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer; 
        }

        section { 
            display: none; 
            text-align: center; 
            padding: 0px; 
        }
        #menu { 
            display: block; 
        }

        /* Style du Scoreboard (Meilleur Score) */
        #best-score-display {
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            color: white; 
            position: absolute;
            top: 90px;
            left: 620px; 
            width: 250px;
            text-align: center;
            padding: 10px;
            border: 2px solid white;
            background-color: #000;
            z-index: 5;
        }

        #retour, #retour-rules {
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            color: white;
            position: absolute;
            top: 90px;
            left: 630px; 
            width: 250px;
            text-align: center;
            padding: 10px;
            border: 2px solid white;
            background-color: #000;
            z-index: 5;
            cursor: pointer;
        }
        /* Ajustement l√©ger de position pour le bouton de retour des r√®gles/param√®tres */
        #retour-rules {
            top: 100px; 
            left: 640px; 
            width: 250px; 
        }

        /* Styles de la bo√Æte de R√®gles et Param√®tres */
        #rules, #param {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
        }
        #rules-box-simple, #param-box {
            position: absolute; 
            top: 200px;
            font-size: medium;
            left: 565px; 
            width: 350px; 
            padding: 20px; 
            background-color: black;
            border: 2px solid white; 
            border-radius: 8px; 
            font-family: 'Press Start 2P', monospace;
            color: #DDDDDD; 
            text-align: left;
            box-shadow: 0 0 10px white;
        }

        /* Styles du texte √† l'int√©rieur de la bo√Æte de r√®gles */
        #rules-box-simple p {
            font-size: 10px;
            line-height: 1.5;
            margin: 10px 0;
        }
        
    </style>
</head>
<body style="background-image: url(vector-black-future.jpg);">
    
    <section id="menu">
        <div id="best-score-display">MEILLEUR SCORE: 0</div>
        <div class="quarter-circle1"></div>
        <div class="quarter-circle2"></div>
        <div class="quarter-circle3"></div>
        <div class="quarter-circle4"></div>
        
        <button onclick="showSection('jeu')" class="simon1"></button>
        <button onclick="showSection('rules')" class="simon2">REGLES</button>
        <button onclick="showSection('param')" class="simon3">PARAMETRES</button>
    </section>
    
    <section id="jeu">
        <button id="retour" onclick="gameOver(true); showSection('menu');">RETOUR AU MENU</button> 
        
        <div id="red-game" class="q1" data-color="red" onclick="handlePlayerClick('red')"></div>
        <div id="green-game" class="q2" data-color="green" onclick="handlePlayerClick('green')"></div>
        <div id="blue-game" class="qc3" data-color="blue" onclick="handlePlayerClick('blue')"></div>
        <div id="yellow-game" class="qc4" data-color="yellow" onclick="handlePlayerClick('yellow')"></div>
    
        <button class="btn" id="btn-game-center"></button>
    </section>
    
    <section id="rules">
        <button id="retour-rules" onclick="showSection('menu')">RETOUR AU MENU</button>

        <div id="rules-box-simple">
            <h2 style="font-size: 24px; color: yellow; text-align: center;">REGLES SIMON</h2>
            <hr style="border-color: white;">
            
            <p><span style="color: #00FF00; font-weight: bold;">OBJECTIF :</span> R√©p√©tez la s√©quence de couleurs de Simon.</p>
            <p><span style="color: #FF6600; font-weight: bold;">TOUR :</span> Simon ajoute une couleur √† chaque tour.</p>
            <p><span style="color: red; font-weight: bold;">PERTE :</span> Une erreur met fin √† la partie. Le score est le nombre de couleurs r√©p√©t√©es.</p>
        </div>
    </section>
    
    <section id="param">
        <button id="retour-rules" onclick="showSection('menu')">RETOUR AU MENU</button>
        
        <div id="param-box">
            <h2 style="font-size: 20px; color: cyan; text-align: center;">AJUSTER LES PARAM√àTRES</h2>
            <hr style="border-color: white;">
            
            <label for="flashDurationInput">Dur√©e du Flash (Vitesse) : <span id="flashDurationValue">350</span> ms</label>
            <input type="range" id="flashDurationInput" min="100" max="600" value="350" step="50" 
                    oninput="updateParams('flashDuration', this.value)">
            <p style="text-align: center; margin-top: 5px;">(100 ms = Rapide / 600 ms = Lent)</p>

            <label for="intervalInput">D√©lai entre Couleurs:<span id="intervalValue">550</span> ms</label>
            <input type="range" id="intervalInput" min="400" max="1000" value="550" step="50"
                    oninput="updateParams('interval', this.value)">
            <p style="text-align: center; margin-top: 5px;">(400 ms = S√©quence Rapide / 1000 ms = Lente)</p>
        </div>
    </section>
    
    <script>
        // --- VARIABLES GLOBALES DU JEU ---
        const COLORS = ['red', 'green', 'blue', 'yellow'];
        const LOCAL_STORAGE_KEY = 'simonSaysBestScore'; 

        let gameSequence = [];
        let playerSequence = [];
        let round = 1;
        let isPlayerTurn = false;
        let gameActive = false; // Vrai si une partie est en cours

        // Param√®tres de vitesse par d√©faut (peuvent √™tre ajust√©s via l'interface)
        let FLASH_DURATION = 350; // Dur√©e du flash
        let INTERVAL = 550; ¬† ¬† ¬† // D√©lai entre le d√©but de deux flashes

        // --- √âL√âMENTS DOM et AUDIO ---

        const Center = document.getElementById('btn-game-center');
        const audioMap = {
            // Remplacez les chemins d'acc√®s par ceux de vos fichiers audio (do.mp3, re.mp3, etc.)
            'red': new Audio('do.mp3'),
            'green': new Audio('re.mp3'),
            'blue': new Audio('mi.mp3'),
            'yellow': new Audio('fa.mp3')
        };
        
        // Cr√©ation des √©l√©ments d'affichage de statut dans le bouton central
        let statusDisplay = document.createElement('span');
        statusDisplay.id = 'game-status';
        statusDisplay.style.fontSize = '14px';
        statusDisplay.style.fontFamily = "'Press Start 2P', monospace"; 
        statusDisplay.textContent = "SIMON SAYS";

        let roundInfo = document.createElement('span');
        roundInfo.id = 'round-info';
        roundInfo.style.fontSize = '10px';
        roundInfo.style.marginTop = '5px';
        roundInfo.style.fontFamily = "'Press Start 2P', monospace";
        roundInfo.textContent = "Tour 0";

        // Insertion des affichages dans le bouton central
        if (Center) {
            Center.innerHTML = '';
            Center.appendChild(statusDisplay);
            Center.appendChild(roundInfo);
        }

        // Map des √©l√©ments du jeu pour un acc√®s facile
        const allQuadrants = {
            'red': document.getElementById('red-game'),
            'green': document.getElementById('green-game'),
            'blue': document.getElementById('blue-game'),
            'yellow': document.getElementById('yellow-game')
        };


        /** Affiche la section demand√©e et g√®re les actions de transition (d√©marrage/score). */
        function showSection(id) {
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            const targetSection = document.getElementById(id);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            if (id === 'menu') {
                displayBestScore();
            } else if (id === 'jeu') {
                startGame(); 
            } else if (id === 'param') {
                syncParamSliders();
            }
        }
        
        function updateParams(paramName, value) {
            const numericValue = parseInt(value, 10);
            
            if (paramName === 'flashDuration') {
                FLASH_DURATION = numericValue;
                document.getElementById('flashDurationValue').textContent = numericValue;
            } else if (paramName === 'interval') {
                INTERVAL = numericValue;
                document.getElementById('intervalValue').textContent = numericValue;
            }
        }
        
        function syncParamSliders() {
            const flashInput = document.getElementById('flashDurationInput');
            const intervalInput = document.getElementById('intervalInput');
            
            if (flashInput) {
                flashInput.value = FLASH_DURATION;
                document.getElementById('flashDurationValue').textContent = FLASH_DURATION;
            }
            if (intervalInput) {
                intervalInput.value = INTERVAL;
                document.getElementById('intervalValue').textContent = INTERVAL;
            }
        }

        // --- GESTION DU SCORE ---

        /** R√©cup√®re le meilleur score stock√© dans le localStorage. */
        function getBestScore() {
            const score = localStorage.getItem(LOCAL_STORAGE_KEY); // Retourne l'entier stock√© ou 0 si rien n'est trouv√©
            return score ? parseInt(score, 10) : 0; 
        }
        /** Met √† jour le meilleur score local si le nouveau score est sup√©rieur. */
        function updateBestScore(newScore) {
            const currentBest = getBestScore();
            if (newScore > currentBest) {
                localStorage.setItem(LOCAL_STORAGE_KEY, newScore.toString());
                return true; // Nouveau record
            }
            return false; // Pas de nouveau record
        }
        /** Met √† jour l'affichage du meilleur score dans le menu. */
        function displayBestScore() {
            const bestScoreElement = document.getElementById('best-score-display');
            const bestScore = getBestScore();
            if (bestScoreElement) {
                bestScoreElement.textContent = `MEILLEUR SCORE: ${bestScore}`;
            }
        }
        /** Fait clignoter un quadrant sp√©cifique et joue le son associ√©. */
        function flashColor(colorId, duration) {
            const element = allQuadrants[colorId];
            const audio = audioMap[colorId];

            if (audio) {
                // R√©initialiser la lecture pour un son rapide
                audio.currentTime = 0; 
                audio.play().catch(e => console.error("Erreur lecture audio:", e));
            }
            if (element) {
                element.classList.add('active'); 
                // Retire la classe 'active' apr√®s la dur√©e sp√©cifi√©e
                setTimeout(() => {
                    element.classList.remove('active');
                }, duration); 
            }
        }

        /** D√©sactive l'animation de pulsation CSS infinie des quartiers de cercle au d√©but du jeu. */
        function disablePulseAnimation() {
            Object.values(allQuadrants).forEach(element => {
                if (element) {
                    element.style.animation = 'none'; 
                    // Remplace le box-shadow anim√© par une ombre fixe
                    element.style.boxShadow = element.style.boxShadow.replace('20px 5px', '10px 3px'); 
                }
            });
        }

        /** Affiche la s√©quence de couleurs (d√©monstration Simon) au joueur. */
        function showSequence(sequence) {
            isPlayerTurn = false; 
            statusDisplay.textContent = "WATCH!";

            let delay = 0;

            sequence.forEach((colorId, index) => {
                setTimeout(() => {
                    flashColor(colorId, FLASH_DURATION);
                    
                    // Une fois le dernier flash termin√©, on donne la main au joueur
                    if (index === sequence.length - 1) {
                        setTimeout(startPlayerTurn, INTERVAL + FLASH_DURATION + 50); // D√©lai apr√®s le dernier flash
                    }
                }, delay);
                
                delay += INTERVAL; // Ajoute l'intervalle pour le prochain flash
            });
        }
        /** D√©marre le tour du joueur (active les clics). */
        function startPlayerTurn() {
            isPlayerTurn = true;
            statusDisplay.textContent = 'Votre tour!';
            const requiredClicks = gameSequence.length;
            const clickWord = (requiredClicks > 1) ? 'Clicks' : 'Click'; 
            
            roundInfo.textContent = `R√©petez ${requiredClicks} ${clickWord}`;
        }
        /** G√®re le clic du joueur sur un quadrant. (Fonction globale pour le HTML onclick) */
        window.handlePlayerClick = function(clickedColor) {
            if (!isPlayerTurn || !gameActive) return; // Ignore si ce n'est pas le tour du joueur

            flashColor(clickedColor, 150); // Flash court lors du clic
            playerSequence.push(clickedColor);
            
            checkPlayerInput(); // V√©rifie la validit√© du clic
        }

        /** V√©rifie si la s√©quence du joueur correspond √† la s√©quence de Simon. */
        function checkPlayerInput() {
            const lastIndex = playerSequence.length - 1;
            
            // 1. V√©rifie si le dernier clic est correct
            if (playerSequence[lastIndex] !== gameSequence[lastIndex]) {
                gameOver(false); // S√©quence incorrecte, fin de partie
                return;
            }

            // 2. V√©rifie si la s√©quence compl√®te a √©t√© r√©p√©t√©e
            if (playerSequence.length === gameSequence.length) {
                statusDisplay.textContent = 'BIEN!';
                isPlayerTurn = false;
                roundInfo.textContent = '';
                round++; // Incr√©menter le round
                
                setTimeout(nextRound, 1500); // Lancer le prochain tour apr√®s un d√©lai
            }
        }

        /** Pr√©pare et d√©marre le tour suivant. */
        function nextRound() {
            if (!gameActive) return;

            playerSequence.length = 0; // R√©initialise la s√©quence du joueur
            
            roundInfo.textContent = ` Tour ${round} `;
            
            // AJOUT: Nouvelle couleur al√©atoire pour √©tendre la s√©quence
            const nextColor = COLORS[Math.floor(Math.random() * COLORS.length)];
            gameSequence.push(nextColor);
            
            showSequence(gameSequence); // Affiche la nouvelle s√©quence
        }

        /** Initialise et commence le jeu. */
        function startGame() {
            gameActive = true;
            round = 1; 
            gameSequence.length = 0;
            playerSequence.length = 0;
            
            disablePulseAnimation(); // Arr√™te l'animation du menu
            setTimeout(nextRound, 1000); // D√©marre le premier round apr√®s un d√©lai
        }
        /** Fin de la partie (par erreur ou par abandon). */
        function gameOver(isQuit) {
            gameActive = false;
            isPlayerTurn = false;
            
            // Le score est la longueur de la s√©quence pr√©c√©dente
            const finalScore = round - 1; 

            if (!isQuit) {
                statusDisplay.textContent = 'Game Over! \n';
                roundInfo.textContent = `Score: ${finalScore}`;

                const isNewRecord = updateBestScore(finalScore);

                let alertMessage = `Game Over! Score: ${finalScore}.`;
                if (isNewRecord) {
                    alertMessage += "\nNOUVEAU SCORE LOCAL ! üèÜ";
                }
                
                // Utiliser setTimeout pour s'assurer que l'affichage est mis √† jour avant l'alerte
                setTimeout(() => {
                    alert(alertMessage);
                    showSection('menu');
                }, 100);
            }
            // R√©initialisation des variables de jeu (utilis√©e apr√®s Game Over ou Quitter)
            gameSequence.length = 0;
            playerSequence.length = 0;
            round = 1;
            statusDisplay.textContent = "SIMON SAYS";
            roundInfo.textContent = "Tour 0";
            displayBestScore();
        }
        // Ex√©cut√© au chargement : Affiche le menu initial
        showSection('menu');

    </script>
</body>
</html>